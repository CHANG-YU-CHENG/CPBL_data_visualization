<!DOCTYPE html>
	<meta charset="utf-8">
    <script src ="http://d3js.org/d3.v3.min.js"></script> <!-- d3 library -->
	<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>  <!-- FireBase library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <!-- jQery library -->
	<link rel="stylesheet" href="styles.css">
    <link rel='stylesheet prefetch' href='https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css'>
<body>
	<!-- ----------------------------------menu--------------------------------- -->
	<div id='menu'>
		<ul>
		<li id="li1"><a href='#' id="1"onclick="change(this)">歷月打擊率(AVG)</a></li>
		<li id="li2"><a href='#' id="2"onclick="change(this)">歷月安打數(H)</a></li>
		<li id="li3"><a href='#' id="3"onclick="change(this)">歷月全壘打數(HR)</a></li>
		<li id="li4"><a href='#' id="4"onclick="change(this)">歷月打點數(RBI)</a></li>
		<li id="li5"><a href='#' id="5"onclick="change(this)">歷月被三振數(SO)</a></li>
		</ul>
	</div>
	<!------------------------------------menu----------------------------------->
		
	<!-- ----------------------------------icon--------------------------------- -->
	<ul class="filters">
		<li>
		  <label>
			<input type="checkbox" id="p0" onclick="add(0)">
			<span class="icon"><i class="fa fa-check"></i></span>
			許基宏
		  </label>
		</li>
		</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p1" onclick="add(1)">
			<span class="icon"><i class="fa fa-check"></i></span>
			周思齊
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p2" onclick="add(2)">
			<span class="icon"><i class="fa fa-check"></i></span>
			張志豪
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p3" onclick="add(3)">
			<span class="icon"><i class="fa fa-check"></i></span>
			陳鏞基
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p4" onclick="add(4)">
			<span class="icon"><i class="fa fa-check"></i></span>
			鄧志偉
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p5" onclick="add(5)">
			<span class="icon"><i class="fa fa-check"></i></span>
			羅國龍
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p6" onclick="add(6)">
			<span class="icon"><i class="fa fa-check"></i></span>
			林智勝
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p7" onclick="add(7)">
			<span class="icon"><i class="fa fa-check"></i></span>
			林泓育
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p8" onclick="add(8)">
			<span class="icon"><i class="fa fa-check"></i></span>
			陳俊秀
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p9" onclick="add(9)">
			<span class="icon"><i class="fa fa-check"></i></span>
			高國輝
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p10" onclick="add(10)">
			<span class="icon"><i class="fa fa-check"></i></span>
			林益全
		  </label>
		</li>
				</br></br>
		<li>
		  <label>
			<input type="checkbox" id="p11" onclick="add(11)">
			<span class="icon"><i class="fa fa-check"></i></span>
			胡金龍
		  </label>
		</li>
	</ul>
	<!-- ----------------------------------icon--------------------------------- -->
<script>
function change(me){
  var id=me.id;
  $('li').removeClass('active');
  $('#li'+id).addClass('active');
  if(page!=id){
    page=id;
    svg.selectAll(".city").remove();
    svg.selectAll(".text").remove();
    show_list=[];
    players=[]; 
    document.getElementById("p0").checked=false;
    document.getElementById("p1").checked=false;
	document.getElementById("p2").checked=false;
    document.getElementById("p3").checked=false;
	document.getElementById("p4").checked=false;
    document.getElementById("p5").checked=false;
	document.getElementById("p6").checked=false;
    document.getElementById("p7").checked=false;
	document.getElementById("p8").checked=false;
    document.getElementById("p9").checked=false;
	document.getElementById("p10").checked=false;
    document.getElementById("p11").checked=false;

    update()

  }
}
function getname(page_num,num){
  var obj = {};
  var myDataRef = new Firebase('https://cpbldata.firebaseio.com/');
  myDataRef.once('value', function(snapshot) {
    obj = snapshot.val();
    var data=[];
    if(num<=2){data = obj.RBI.Brothers[num];}
    else if(num<=5){data =obj.RBI.Uni_Lions[num-3];}
    else if(num<=8){data = obj.RBI.EDA_Rhinos[num-6];}
    else if(num<=11){data = obj.RBI.Lamigo_Monkeys[num-9];}
    return data[0];

    }); 

}
function firebase(page_num,num,first){
  var obj = {};
  var myDataRef = new Firebase('https://cpbldata.firebaseio.com/');
  myDataRef.once('value', function(snapshot) {
    obj = snapshot.val();
    var data=[];
    if(page_num==1){
          if(num<=2){data = obj.AVG.Brothers[num];}
          else if(num<=5){data =obj.AVG.Uni_Lions[num-3];}
          else if(num<=8){data = obj.AVG.EDA_Rhinos[num-6];}
          else if(num<=11){data = obj.AVG.Lamigo_Monkeys[num-9];}
    }
    else if(page_num==2){
          if(num<=2){data = obj.H.Brothers[num];}
          else if(num<=5){data =obj.H.Uni_Lions[num-3];}
          else if(num<=8){data = obj.H.EDA_Rhinos[num-6];}
          else if(num<=11){data = obj.H.Lamigo_Monkeys[num-9];}
    }
    else if(page_num==3){
          if(num<=2){data = obj.HR.Brothers[num];}
          else if(num<=5){data =obj.HR.Uni_Lions[num-3];}
          else if(num<=8){data = obj.HR.EDA_Rhinos[num-6];}
          else if(num<=11){data = obj.HR.Lamigo_Monkeys[num-9];}
    }
    else if(page_num==4){
          if(num<=2){data = obj.RBI.Brothers[num];}
          else if(num<=5){data =obj.RBI.Uni_Lions[num-3];}
          else if(num<=8){data = obj.RBI.EDA_Rhinos[num-6];}
          else if(num<=11){data = obj.RBI.Lamigo_Monkeys[num-9];}
    }
    else if(page_num==5){
          if(num<=2){data = obj.SO.Brothers[num];}
          else if(num<=5){data =obj.SO.Uni_Lions[num-3];}
          else if(num<=8){data = obj.SO.EDA_Rhinos[num-6];}
          else if(num<=11){data = obj.SO.Lamigo_Monkeys[num-9];}
    }

    if(first==1){
      var tem_name=data[0];
      data.splice(0,1);
      line_chart(data,tem_name);
    }
    else{      
      add2(data);
    }
    }); 
}
function add(num){
  var data=firebase(page,num,0);
}
function add2(data){
  var name=data[0];
  var position=jQuery.inArray(name,show_list);

  if(  position==-1){
    show_list.push(data[0]);
    data.splice(0,1); 
    players.push({
      name:name,
      values: index.map(function(d){
          return {date: date[d], score: +data[d]};})
      }) ;
        
    svg.selectAll(".city").remove();
    svg.selectAll(".text").remove();    
    update();
  }//for if
  else{
    show_list.splice(position,1); //除去選手資料
    var i=0;
    for( i=0;i<players.length;i++){
      if(players[i].name==name)
        {break;}
       }
    players.splice(i,1);  //除去選手資料
    //console.log(show_list);
    //console.log(players);
    svg.selectAll(".city").remove();
    svg.selectAll(".text").remove();
    update();
  }//for else
  
}
function getcolor(name){
  for(var i=0;i<12;i++){
    if(color[i].name==name){
      break;
    }
  }
  return color[i].value;
}

function update(){
  //****
//建立資料
//可以快速地取出一個陣列中的最小值跟最大值
  x.domain([3,10]);
  y.domain([
    d3.min(players, function(c) { return d3.min(c.values, function(v) { return v.score; }); }),
    d3.max(players, function(c) { return d3.max(c.values, function(v) { return v.score; }); })
  ]);
    line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.score); });

//******
//建立資料  
  var new_svg = d3.select("body").transition();

    new_svg.select(".x.axis")   // change the line
      .duration(500)
      .call(xAxis);

    new_svg.select(".y.axis")
      .duration(500)
      .call(yAxis);

  if(show_list.length>0){
  var new_city = svg.selectAll(".city")
      .data(players)
    .enter().append("g")
      .attr("class", "city");

  new_city.append("path")
      .attr("class", "line")
      .attr("d",function(d) { return line(d.values); })
      .style("stroke", function(d) {   return getcolor(d.name); });

  new_city.append("text")
      .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
      .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.score) + ")"; })
      .attr("x", 3)
      .attr("dy", ".35em")
      .text(function(d) { return d.name; })
      .style("fill", function(d){ return getcolor(d.name);});

    }
}
</script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
var page=1;
var show_list =[];
var date=['3','4','5','6','7','8','9','10'];
var index=[0,1,2,3,4,5,6,7];
var color=[
      {name:"許基宏",value:"#ffd500"},
      {name:"周思齊",value:"#FFDA2D"},
      {name:"張志豪",value:"#CEAA00"},
      {name:"陳鏞基",value:"#ff8800"},
      {name:"鄧志偉",value:"#FF9E33"},
      {name:"羅國龍",value:"#DD7400"},
      {name:"高國輝",value:"#9e00b0"},
      {name:"林益全",value:"#D000E8"},
      {name:"胡金龍",value:"#820091"},
      {name:"林智勝",value:"#4682b3"},
      {name:"林泓育",value:"#6598C2"},
      {name:"陳俊秀",value:"#3A6B94"}
      ];
$('#li'+page).addClass('active');

firebase(page,0,1);
////
////
var margin = {top: 20, right: 80, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .tickFormat(function(d){return d+'月';});

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.score); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
var players ;

function line_chart(data,name) {
//****
//建立資料
  show_list.push(name);
  players = show_list.map(function(name) {
    return {
      name: name,
      values: index.map(function(d){
        return {date: date[d], score: +data[d]};
      })
    };
  });
//可以快速地取出一個陣列中的最小值跟最大值

  x.domain([3,10]);
  y.domain([
    d3.min(players, function(c) { return d3.min(c.values, function(v) { return v.score; }); }),
    d3.max(players, function(c) { return d3.max(c.values, function(v) { return v.score; }); })
  ]);

//******
//建立資料  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")      
      .attr("x", 6)
      .attr("dx", ".71em")
      .style("text-anchor", "start")

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Score");
    show_list=[];
    players=[];

};

</script>